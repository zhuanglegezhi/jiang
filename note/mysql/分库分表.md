分库分表

#### 水平分库

![不用找了，大厂在用的分库分表方案，都在这里！2](https://res-static.hc-cdn.cn/fms/img/72aede70ff9674df865dfddd5e08aa251603777249847)

概念：以字段为依据，按照一定策略（hash、range等），将一个库中的数据拆分到多个库中。结果：

- 每个库的结构都一样；
- 每个库的数据都不一样，没有交集；
- 所有库的并集是全量数据；

场景：系统绝对并发量上来了，分表难以根本上解决问题，并且还没有明显的业务归属来垂直分库。



#### 水平分表

![不用找了，大厂在用的分库分表方案，都在这里！3](https://res-static.hc-cdn.cn/fms/img/a3ae99fa3cd27812a01c31f9f35ec0ea1603777249847)

概念：以字段为依据，按照一定策略（hash、range等），将一个表中的数据拆分到多个表中。

- 每个表的结构都一样；
- 每个表的数据都不一样，没有交集；
- 所有表的并集是全量数据；

场景：系统绝对并发量并没有上来，只是单表的数据量太多，影响了SQL效率，加重了CPU负担，以至于成为瓶颈。

#### 

#### 垂直分库

![不用找了，大厂在用的分库分表方案，都在这里！4](https://res-static.hc-cdn.cn/fms/img/a429cf6668b7545b1dcd10cb565ed5b51603777249848)

概念：以表为依据，按照业务归属不同，将不同的表拆分到不同的库中。

- 每个库的结构都不一样；
- 每个库的数据也不一样，没有交集；
- 所有库的并集是全量数据；

场景：系统绝对并发量上来了，并且可以抽象出单独的业务模块。

分析：到这一步，基本上就可以服务化了。例如，随着业务的发展一些公用的配置表、字典表等越来越多，这时可以将这些表拆到单独的库中，甚至可以服务化。再有，随着业务的发展孵化出了一套业务模式，这时可以将相关的表拆到单独的库中，甚至可以服务化。



#### 垂直分表

![不用找了，大厂在用的分库分表方案，都在这里！5](https://res-static.hc-cdn.cn/fms/img/5c5c5332fd0547e400fdbe835efb69321603777249848)

概念：以字段为依据，按照字段的活跃性，将表中字段拆到不同的表（主表和扩展表）中。

- 每个表的结构都不一样；
- 每个表的数据也不一样，一般来说，每个表的字段至少有一列交集，一般是主键，用于关联数据；
- 所有表的并集是全量数据；

场景：系统绝对并发量并没有上来，表的记录并不多，但是字段多，并且热点数据和非热点数据在一起，单行数据所需的存储空间较大。以至于数据库缓存的数据行减少，查询时会去读磁盘数据产生大量的随机读IO，产生IO瓶颈。

分析：可以用列表页和详情页来帮助理解。垂直分表的拆分原则是将热点数据（可能会冗余经常一起查询的数据）放在一起作为主表，非热点数据放在一起作为扩展表。这样更多的热点数据就能被缓存下来，进而减少了随机读IO。拆了之后，要想获得全部数据就需要关联两个表来取数据。但记住，千万别用join，因为join不仅会增加CPU负担并且会讲两个表耦合在一起（必须在一个数据库实例上）。关联数据，应该在业务Service层做文章，分别获取主表和扩展表数据然后用关联字段关联得到全部数据。
