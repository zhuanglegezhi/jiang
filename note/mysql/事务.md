#### ACID

事务是由一组SQL语句组成的逻辑处理单元，事务具有4属性，通常称为事务的ACID属性。

- **原子性（Actomicity）**：事务是一个原子操作单元，其对数据的修改，要么全都执行，要么全都不执行。

- **一致性（Consistent）**：在事务开始和完成时，数据都必须保持一致状态。这意味着所有相关的数据规则都必须应用于事务的修改，以操持完整性；事务结束时，所有的内部数据结构（如B树索引或双向链表）也都必须是正确的。

- **隔离性（Isolation**）：数据库系统提供一定的隔离机制，保证事务在不受外部并发操作影响的“独立”环境执行。这意味着事务处理过程中的中间状态对外部是不可见的，反之亦然。

- **持久性（Durable**）：事务完成之后，它对于数据的修改是永久性的，即使出现系统故障也能够保持。

  

### mvvc 

原理：undo log + read view

限制：MVCC只在 READ COMMITTED 和 REPEATABLE READ 两个隔离级别下工作。其他两个隔离级别够和MVCC不兼容，因为 READ UNCOMMITTED 总是读取最新的数据行，而不是符合当前事务版本的数据行。而 SERIALIZABLE 则会对所有读取的行都加锁。

InnoDB中通过undo log实现了数据的多版本，而并发控制通过锁来实现。

InnoDB存储引擎在数据库每行数据的后面添加了三个字段

- 6字节的事务ID(DB_TRX_ID)字段：用来标识最近一次对本行记录做修改(insert|update)的事务的标识符，即最后一次修改(insert|update)本行记录的事务id。至于delete操作，在innodb看来也不过是一次update操作，更新行中的一个特殊位将行表示为deleted，并非真正删除。
- 7字节的回滚指针(DB_ROLL_PTR)字段：指写入回滚段(rollback segment)的 undo log record (撤销日志记录记录)。如果一行记录被更新, 则 undo log record 包含 ‘重建该行记录被更新之前内容’ 所必须的信息。
- 6字节的DB_ROW_ID字段：包含一个随着新行插入而单调递增的行ID，当由innodb自动产生聚集索引时，聚集索引会包括这个行ID的值，否则这个行ID不会出现在任何索引中。



READ COMMITTED 和 REPEATABLE READ 隔离级别的的一个非常大的区别就是它们生成 `ReadView` 的时机不同。

- 在 READ COMMITTED 中`每次查询`都会生成一个实时的 ReadView，做到保证每次提交后的数据是处于当前的可见状态。
- 而 REPEATABLE READ 中，在当前事务`第一次查询时`生成当前的 ReadView，并且当前的 ReadView 会一直沿用到当前事务提交，以此来保证可重复读（REPEATABLE READ）。
  
  

refer:

https://zhuanlan.zhihu.com/p/66791480

https://blog.csdn.net/qq_35190492/article/details/109044141

### bin log vs redo log vs undo log

- bin log
  - `binlog `用于记录数据库执行的写入性操作(不包括查询)信息，以二进制的形式保存在磁盘中
  - 使用场景
    - 主从复制
    - 数据恢复
- redo log
- undo log
  - 实现`MVVC`

redolog时机.png![redolog时机](https://user-images.githubusercontent.com/17567449/123726829-38e9c980-d8c3-11eb-9717-5452247e4d55.png)



